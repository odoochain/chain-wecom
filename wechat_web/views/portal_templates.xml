<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <data>

        <template id="portal_breadcrumbs" name="Portal Breadcrumbs">
            <ol t-if="page_name != 'home'" class="o_portal_submenu breadcrumb mb-0 py-2 flex-grow-1">
                <li class="breadcrumb-item ms-1">
                    <a href="/wechat/web" aria-label="Home" title="Home">
                        <i class="fa fa-home fa-lg"/>
                    </a>
                </li>
                <li t-if="page_name == 'my_account'" class="breadcrumb-item">My Account</li>
            </ol>
        </template>

        <template id="record_pager" name="Portal Record Pager">
            <t t-if='prev_record or next_record'>
                <div class="record_pager btn-group" role="group">
                    <a role="button" t-att-class="'btn btn-link %s' % ('disabled' if not prev_record else '')" t-att-href="prev_record or '#'">
                        <i class="fa fa-chevron-left" role="img" aria-label="Previous" title="Previous"></i>
                    </a>
                    <a role="button" t-att-class="'btn btn-link %s' % ('disabled' if not next_record else '')" t-att-href="next_record or '#'">
                        <i class="fa fa-chevron-right" role="img" aria-label="Next" title="Next"></i>
                    </a>
                </div>
            </t>
        </template>

        <template id="frontend_layout" name="Main Frontend Layout" inherit_id="web.frontend_layout">
            <xpath expr="//div[@id='wrapwrap']" position="attributes">
                <attribute name="t-attf-class" add="#{request.env['res.lang']._lang_get_direction(request.env.lang) == 'rtl' and 'o_rtl' or ''}" separator=" "/>
                <attribute name="t-attf-class" add="#{'o_wechat_portal_home' if is_portal else ''}" separator=" "/>
            </xpath>

            <xpath expr="//div[@id='wrapwrap']/main/t[@t-out='0']" position="before">
                <div t-if="o_portal_fullwidth_alert" class="alert alert-info alert-dismissible rounded-0 fade show d-print-none css_editable_mode_hidden">
                    <div class="container">
                        <t t-out="o_portal_fullwidth_alert"/>
                    </div>
                </div>
            </xpath>

            <!-- 页脚导航菜单 -->
            <xpath expr="//div[@id='footer']" position="inside">
                <div role="tablist" aria-label="" class="weui-tabbar">
                    <a id="tab1" role="tab" aria-labelledby="t1_title" aria-describedby="t1_tips" aria-selected="true" aria-controls="panel1" class="weui-tabbar__item weui-bar__item_on" wah-hotarea="click" href="/wechat/web/home">
                        <div class="weui-tabbar__icon">
                            <i class="fa fa-2x fa-fw fa-home"/>
                        </div>
                        <p id="t1_title" aria-hidden="true" class="weui-tabbar__label">Home</p>
                    </a>
                    <a id="tab4" role="tab" aria-labelledby="t4_title" aria-describedby="t4_tips" aria-selected="true" aria-controls="panel4" class="weui-tabbar__item weui-bar__item_on" wah-hotarea="click" href="/wechat/web/my">
                        <div class="weui-tabbar__icon">
                            <i class="fa fa-2x fa-fw fa-user"/>
                        </div>
                        <p class="weui-tabbar__label" aria-hidden="true" id="t4_title">My</p>
                    </a>
                </div>
            </xpath>
        </template>

        <template id="portal_layout" name="Portal Layout">
            <t t-call="wechat_web.frontend_layout">
                <t t-set="is_portal" t-value="True"/>

                <div t-if="not no_breadcrumbs and not my_account and not breadcrumbs_searchbar" class="o_portal container mt-3">
                    <div class="row align-items-center bg-white g-0 border rounded">
                        <div class="col-12">
                            <t t-call="wechat_web.portal_breadcrumbs"></t>
                        </div>
                        <div t-if="prev_record or next_record" class="col-2 flex-grow-0 text-center">
                            <t t-call='wechat_web.record_pager'/>
                        </div>
                    </div>
                </div>
                <div id="wrap" class='o_portal_wrap'>
                    <div class="container mb64">
                        <t t-out="0"/>
                    </div>
                </div>
            </t>
        </template>

        <template id="home" name="Wechat Portal">
            <t t-call="wechat_web.portal_layout">

                <div class="o_wechat_portal_home">
                    <div class="oe_structure" id="oe_structure_portal_my_home_1"/>
                    <h3>Documents</h3>
                    <div class="o_portal_docs list-group">
                        <div class="o_portal_doc_spinner spinner-border text-o-color-2 align-self-center mt-5"/>
                        <p class="o_portal_no_doc_message  d-none">No Documents to display</p>
                    </div>
                </div>
                <div class="oe_structure" id="oe_structure_portal_my_home_2"/>
            </t>
        </template>

        <template id="portal_docs_entry" name="My Portal Docs Entry">
            <a t-att-href="url" t-att-title="title" class="list-group-item list-group-item-action d-flex align-items-center justify-content-between d-none">
                <t t-esc="title"/>
                <t t-if='count'>
                    <span class="badge text-bg-secondary rounded-pill" t-esc="count"/>
                </t>
                <t t-elif="placeholder_count">
                    <span class="badge text-bg-secondary rounded-pill" t-att-data-placeholder_count="placeholder_count">
                        <i class="fa fa-spin fa-circle-o-notch"></i>
                    </span>
                </t>
            </a>
        </template>

        <template id="portal_table" name="My Portal Table">
            <div t-attf-class="table-responsive border rounded border-top-0 #{classes if classes else ''}">
                <table class="table rounded mb-0 bg-white o_portal_my_doc_table">
                    <t t-out="0"/>
                </table>
            </div>
            <div t-if="pager" class="o_portal_pager d-flex justify-content-center">
                <t t-call="portal.pager"/>
            </div>
        </template>


        <!--
        The search bar is composed of 2 buttons : a "filter by" and a "sort by". Changing the 'sortby'
        criteria will keep the number of page, query params, ... Changing the 'filterby' param will
        redirect the user to the beginning of document list, keeping query parameters.

        These 2 buttons can be prepended by a advanced search input, to activate it, search_input need
        to be initialized at 'True' and the content of the t-call is the list of li elements searchable.

        :param dict searchbar_sortings : containing the sort criteria like
            {'date': {'label': _('Newest'), 'order': 'create_date desc'}}
        :param string sortby : name of the sort criteria
        :param dict searchbar_filters : containing the filter criteria like
            {'open': {'label': _('In Progress'), 'domain': [('state', '=', 'open')]}}
        :param string filterby : name of the filter criteria
        :param default_url : the base url of the pages (like '/my/orders')
        :param boolean breadcrumbs_searchbar : set to True to show breadcrumbs rather than the title
        :param boolean o_portal_search_panel : set to True to active the input search
        :param html $0 : content of the t-call
        :param title : bavbar title
        :param classes : navbar classes
    -->
        <template id="portal_searchbar" name="Portal Search Bar">
            <nav t-attf-class="navbar navbar-light navbar-expand-lg border py-0 mb-2 o_portal_navbar {{classes if classes else ''}} {{'mt-3 rounded' if breadcrumbs_searchbar else 'border-top-0' }}">
                <!--  Navbar breadcrumb or title  -->
                <t t-if="breadcrumbs_searchbar">
                    <t t-call="portal.portal_breadcrumbs"/>
                </t>
                <span t-else="" class="navbar-brand mb-0 h1 me-auto" t-esc="title or 'No title'"/>

                <!--  Collapse button -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#o_portal_navbar_content" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle filters">
                    <span class="navbar-toggler-icon small"/>
                </button>

                <!--  Collapsable content  -->
                <div class="collapse navbar-collapse" id="o_portal_navbar_content">
                    <div class="nav flex-column flex-lg-row ms-auto p-0 mb-3 mb-lg-0 mt-1 mt-lg-0">
                        <div t-if="searchbar_sortings">
                            <span class="small me-1 navbar-text">Sort By:</span>
                            <div class="btn-group">
                                <button id="portal_searchbar_sortby" data-bs-toggle="dropdown" class="btn btn-secondary btn-sm dropdown-toggle">
                                    <t t-esc="searchbar_sortings[sortby].get('label', 'Newest')"/>
                                </button>
                                <div class="dropdown-menu" aria-labelledby="portal_searchbar_sortby">
                                    <t t-foreach="searchbar_sortings" t-as="option">
                                        <a t-att-href="request.httprequest.path + '?' + keep_query('*', sortby=option)" t-attf-class="dropdown-item#{sortby == option and ' active' or ''}">
                                            <span t-esc="searchbar_sortings[option].get('label')"/>
                                        </a>
                                    </t>
                                </div>
                            </div>
                        </div>
                        <div t-if="searchbar_filters" class="ms-lg-2">
                            <span class="small me-1 navbar-text">Filter By:</span>
                            <div class="btn-group">
                                <button id="portal_searchbar_filters" data-bs-toggle="dropdown" class="btn btn-secondary btn-sm dropdown-toggle">
                                    <t t-esc="searchbar_filters.get(filterby,searchbar_filters.get('all')).get('label', 'All')"/>
                                </button>
                                <div class="dropdown-menu" aria-labelledby="portal_searchbar_filters">
                                    <t t-foreach="searchbar_filters" t-as="option">
                                        <a t-att-href="default_url + '?' + keep_query('*', filterby=option)" t-attf-class="dropdown-item#{filterby == option and ' active' or ''}">
                                            <span t-esc="searchbar_filters[option].get('label')"/>
                                        </a>
                                    </t>
                                </div>
                            </div>
                        </div>
                        <div t-if="searchbar_groupby" class="ms-lg-2">
                            <span class="small me-1 navbar-text">Group By:</span>
                            <div class="btn-group">
                                <button id="portal_searchbar_groupby" data-bs-toggle="dropdown" class="btn btn-secondary btn-sm dropdown-toggle">
                                    <t t-esc="searchbar_groupby[groupby].get('label', 'None')"/>
                                </button>
                                <div class="dropdown-menu" aria-labelledby="portal_searchbar_groupby">
                                    <t t-foreach="searchbar_groupby" t-as="option">
                                        <a t-att-href="default_url + '?' + keep_query('*', groupby=option)" t-attf-class="dropdown-item#{groupby == option and ' active' or ''}">
                                            <span t-esc="searchbar_groupby[option].get('label')"/>
                                        </a>
                                    </t>
                                </div>
                            </div>
                        </div>
                        <t t-out="0"/>
                    </div>
                    <form t-if="searchbar_inputs" class="o_portal_search_panel ms-lg-4 col-xl-4 col-md-5">
                        <div class="input-group input-group-sm w-100">
                            <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown"/>
                            <div class="dropdown-menu" role="menu">
                                <t t-foreach='searchbar_inputs' t-as='input'>
                                    <a t-att-href="'#' + input_value['input']" t-attf-class="dropdown-item#{search_in == input_value['input'] and ' active' or ''}">
                                        <span t-out="input_value['label']"/>
                                    </a>
                                </t>
                            </div>
                            <input type="text" class="form-control form-control-sm" placeholder="Search" t-att-value='search' name="search"/>
                            <button class="btn btn-secondary o_wait_lazy_js" type="submit">
                                <span class="fa fa-search"/>
                            </button>
                        </div>
                    </form>
                </div>
            </nav>
        </template>

        <template id="portal_record_layout" name="Portal single record layout">
            <div t-attf-class="card mt-0 border-top-0 rounded-0 rounded-bottom #{classes if classes else ''}">
                <div t-if="card_header" t-attf-class="card-header #{header_classes if header_classes else ''}">
                    <t t-out="card_header"/>
                </div>
                <div t-if="card_body" t-attf-class="card-body #{body_classes if body_classes else ''}">
                    <t t-out="card_body"/>
                </div>
            </div>
        </template>


        <template id="my" name="Portal Layout">
            <t t-call="wechat_web.portal_layout">

                <div t-if="page_name == 'my_account'" id="wrap" class='o_portal_wrap'>
                    <div class="container mb64">
                        <div class="row justify-content-between">
                            <div id="o_my_sidebar" class="pt-3 pt-lg-0 col-12 col-md col-lg-4 col-xl-3 o_my_sidebar">
                                <div class="o_my_contact" t-if="sales_user">
                                    <t t-call="portal.portal_contact"/>
                                </div>
                                <div class="o_portal_my_account">
                                    <h4>Details
                                        <a role="button" href="/wechat/web/my/account" class="btn btn-sm btn-link">
                                            <i class="fa fa-pencil"/>
                                            <span>Edit</span>
                                        </a>
                                    </h4>
                                    <hr class="mt-1 mb-0"/>
                                    <div t-field="user_id.partner_id" t-options='{"widget": "contact", "fields": ["email", "phone", "address", "name"]}'/>
                                </div>
                                <div class="o_portal_my_security mt-3">
                                    <h4>Account Security </h4>
                                    <hr class="mt-1 mb-1"/>
                                    <a href="/wechat/web/my/security">
                                        <i class="fa fa-pencil mx-1"/>
                                        <span>Edit Security Settings</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>

        <template id="portal_my_details">
            <t t-call="portal.portal_layout">
                <t t-set="additional_title">Contact Details</t>
                <form action="/wechat/web/my/account" method="post">
                    <div class="row o_portal_details">
                        <div class="col-lg-8">
                            <div class="row">
                                <t t-call="portal.portal_my_details_fields"/>
                                <input type="hidden" name="redirect" t-att-value="redirect"/>
                            </div>
                            <div class="clearfix">
                                <button type="submit" class="btn btn-primary float-end mb32 ">
                                Confirm
                                    <span class="fa fa-long-arrow-right" />
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </t>
        </template>

        <template id="portal_my_security">
            <t t-call="wechat_web.portal_layout">
                <div class="o_portal_security_body">
                    <t t-set="additional_title">Security</t>
                    <t t-set="no_breadcrumbs" t-value="1"/>
                    <div class="alert alert-danger" role="alert" t-if="get_error(errors)">
                        <t t-esc="errors"/>
                    </div>
                    <section name="portal_change_password">
                        <h3>Change Password</h3>
                        <t t-set="path">password</t>
                        <div class="alert alert-success" role="alert" t-if="success and success.get('password')">
                            Password Updated!
                        </div>
                        <div class="alert alert-danger" role="alert" t-if="get_error(errors, 'password')">
                            <t t-esc="errors['password']"/>
                        </div>
                        <form action="/wechat/web/my/security" method="post" class="oe_reset_password_form">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <input type="hidden" name="op" value="password"/>
                            <div class="mb-3">
                                <label for="current">Password:</label>
                                <input type="password" t-attf-class="form-control form-control-sm {{ 'is-invalid' if get_error(errors, 'password.old') else '' }}" id="current" name="old" autocomplete="current-password" required="required"/>
                                <div class="invalid-feedback">
                                    <t t-esc="get_error(errors, 'password.old')"/>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="new">New Password:</label>
                                <input type="password" t-attf-class="form-control form-control-sm {{ 'is-invalid' if get_error(errors, 'password.new1') else '' }}" id="new" name="new1" autocomplete="new-password" required="required"/>
                                <div class="invalid-feedback">
                                    <t t-esc="get_error(errors, 'password.new1')"/>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="new2">Verify New Password:</label>
                                <input type="password" t-attf-class="form-control form-control-sm {{ 'is-invalid' if get_error(errors, 'password.new2') else '' }}" id="new2" name="new2" autocomplete="new-password" required="required"/>
                                <div class="invalid-feedback">
                                    <t t-esc="get_error(errors, 'password.new2')"/>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-secondary">Change Password</button>
                        </form>
                    </section>
                    <section t-if="debug and allow_api_keys">
                        <h3>
                            Developer API Keys
                            <a href="https://www.odoo.com/documentation/16.0/developer/misc/api/external_api.html#api-keys" target="_blank">
                                <i title="Documentation" class="fa fa-fw o_button_icon fa-info-circle"></i>
                            </a>
                        </h3>
                        <div>
                            <table class="table o_main_table">
                                <thead>
                                    <tr>
                                        <th>Description</th>
                                        <th>Scope</th>
                                        <th>Added On</th>
                                        <th/>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="request.env.user.api_key_ids" t-as="key">
                                        <tr>
                                            <td>
                                                <span t-field="key.name"/>
                                            </td>
                                            <td>
                                                <span t-field="key.scope"/>
                                            </td>
                                            <td>
                                                <span t-field="key.create_date"/>
                                            </td>
                                            <td>
                                                <i class="fa fa-trash text-danger o_portal_remove_api_key" type="button" t-att-id="key.id"/>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>
                        <div>
                            <button type="submit" class="btn btn-secondary o_portal_new_api_key">New API Key</button>
                        </div>
                    </section>
                    <!-- <section name="portal_deactivate_account" groups="base.group_portal">
                        <h3>Delete Account</h3>
                        <t t-set="deactivate_error" t-value="get_error(errors, 'deactivate')"/>
                        <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#portal_deactivate_account_modal">
                            Delete Account
                        </button>
                        <div t-attf-class="modal #{'show d-block' if open_deactivate_modal else ''}" id="portal_deactivate_account_modal" tabindex="-1" role="dialog">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header bg-danger">
                                        <h5 class="modal-title">Are you sure you want to do this?</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <form action="/wechat/my/deactivate_account" method="post" class="modal-body" id="portal_deactivate_account_form">
                                        <div>
                                            <div class="alert alert-danger" t-esc="get_error(errors, 'deactivate.other')"/>
                                                <p class="text-muted">
                                                    Disable your account, preventing any further login.<br/>
                                                <b>
                                                    <i class="fa fa-exclamation-triangle text-danger"></i>
                                                    This action cannot be undone.
                                                </b>
                                            </p>
                                            <hr/>
                                            <p>1. Enter your password to confirm you own this account</p>
                                            <input name="password" type="password" required="1" t-attf-class="form-control #{'is-invalid' if deactivate_error == 'password' else ''}" placeholder="Password"/>
                                            <div t-if="deactivate_error == 'password'" class="invalid-feedback">
                                                Wrong password.
                                            </div>
                                            <hr/>
                                            <p>
                                                <span>2. Confirm you want to delete your account by copying down your login (</span>
                                                <span t-esc="env.user.login"/>
                                                <span>).</span>
                                            </p>
                                            <input name="validation" type="text" required="1" t-attf-class="form-control #{'is-invalid' if deactivate_error == 'validation' else ''}"/>
                                            <div t-if="deactivate_error == 'validation'" class="invalid-feedback">
                                                <span>You should enter "</span>
                                                <span t-esc="env.user.login"/>
                                                <span>" to validate your action.</span>
                                            </div>
                                            <div class="d-flex flex-row align-items-center">
                                                <input type="checkbox" name="request_blacklist" id="request_blacklist" checked="1"/>
                                                <label for="request_blacklist" class="ms-2 mw-100 fw-normal mt-3">
                                                Put my email and phone in a block list to make sure I'm never contacted again
                                                </label>
                                            </div>
                                        </div>
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    </form>
                                    <div class="modal-footer justify-content-start">
                                        <input type="submit" class="btn btn-danger" form="portal_deactivate_account_form" value="Delete Account"/>
                                        <button type="button" class="btn" data-bs-dismiss="modal">
                                                Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section> -->
                </div>
            </t>
        </template>

    </data>

</odoo>